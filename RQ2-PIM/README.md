# RQ2: PIM Metamodel

<br/>

PIM metamodel diagram is provided below (click on the image to view it in full size)

<img src="https://github.com/MiSAR-A/Journal-Results/blob/master/RQ2-PIM/images/PIM.png" />

<br/>

As a result of our empirical study, we introduce our updated version of **MISAR** microservice architecture metamodel as shown in the above Figure. The new version aimed to be generic, extendible and more comprehensive in order to model almost any microservice architecture built in any platform or technology.  In regard to RQ2, this metamodel is supposed to comprehensively model microservices along with service pattern components implemented in them including server components and client components. Our enhanced metamodel is intended to provide a way to define microservice architecture from static structure and dynamic interaction points of view. Explanation of updated concepts in the result model is provided as the following:

PSM Concept | PSM Attribute(s) | Description
------------ | ------------- | -------------
`MicroservicesArchitectureModel` | `ArchitectureName` | It models microservice architecture from *static* and *interaction* points of view. It particularly represents: <br/>**(a) deployment** aspect concerning the environment where microservices are deployed to. Elements capturing that aspect include: `Ambient` and `Container`, <br/>**(b) microservice repository** aspect concerning the set of all microservices, their types, e.g. functional or infrastructure, and pattern components. Elements capturing that aspect include: `Microservice`, `FunctionalMicroservice`, `InfrastructureMicroservice`, `ServicePatternComponent`, `ServerComponent` and `ClientComponent`. <br/>**(c) interaction interface** aspect concerning the messaging mechanism that microservices use to communicate with its clients. It defines two basic interaction styles; *synchronous* and *asynchronous*. Elements capturing that aspect include: `ServiceInterface`, `ServiceDestination`, `SynchronousServiceDestination`, `RestEndpoint`, `AsynchronousServiceDestination`, `AmqpExchange`, `AmqpQueue`, `InboundQueue`, `OutboundQueue`, `ServiceOperation` and `ServiceMessage`. <br/>**(d) inter-microservice interaction** aspect concerning the inter-service dependency and exchange of information communication among microservices composing an architecture. It doesn’t represent communications that occur from outside the architecture. One element capturing this aspect is `ServiceDependency`. 
`ServicePatternComponent`| `PatternCategory`, `ComponentRole` | [Service Pattern](https://microservices.io/patterns/microservices.html) in a micoservice is the answer of a particular concern or question about micoservice that is related to its infrastructure, communication and other non-functional areas separate from its business logic. Examples of common microservice patterns include: *service registry*, *service discovery*, *service routing*, *service security*, *client resiliency* and *data storage*. These patterns are implemented by frameworks, e.g. [Spring Cloud and Netflix OOS](https://cloud.spring.io/spring-cloud-netflix/spring-cloud-netflix.html), as components to handle cross-cutting concerns of all microservices com-posing an architecture. Our enhanced model introduces this element to abstract the infrastructure patterns defined separately in the previous model. This element allows to represent any pattern or concern component that can be used in a microservice. It is defined by pattern category and the role of the component. <br/>For the sake of our study, we define nine pattern categories in an enumeration type that consists of **Centralized Configuration**, **Service Routing** (e.g. API gateway), **Service Discovery**, **Service Registry**, **Service Client Resiliency** (e.g. circuit breaker and load balancer), **Service Security** (e.g. OAuth2 token-based and web security), **Data Store** (e.g. in-memory, persistent and cache), **Asynchronous Messaging**, **Service Observability** (e,g, log analysis, monitoring and tracing) and **Miscellaneous** (i.e. any infrastructure pattern not listed).
`DockerComposeFile` | | this element maps to Docker compose file, i.e. a YAML file that defines orchestration of microservice applica-tions’ containers at runtime and other network-related information, i.e. links among containers. One `DockerComposeFile` represents one consolidated Docker compose file that has many service definition keys, mapped to `ContainerDefinition` elements, each has zero or many ‘links’ / ’depends_on’ keys, mapped to `ContainerDependency` elements.
`ContainerDefinition` | `ServiceName`, `ImageField`, `BuildField`, `LoggingField`, `VolumesLogField` | this element may refer to a local microservice project, mapped by `MicroserviceProjectArtifactsModel` element, or to an image of an external service, e.g. located in Docker hub repository.  
`ContainerDependency` | `DependencyOrder` | this element represents an ordered dependency association between one dependent / consumer `ContainerDefinition` element to one or many `ContainerDefinition` ‘provider’ elements. 
`SystemProjectBuildFile` | `ProjectArtifactId` | this element is a generalization of any artefact generated by a build framework used to compile the root project along with its subprojects. For example, two frameworks were found in the selected studies used to build `Spring Boot` applications; `Maven`and `Gradle`. Maven build file is an XML representation of a project held in a file named `pom.xml`. POM stands for "Project Object Model". A **Maven** project could represent an entire system project or an individual micro service’s project. A system root project consisting of subprojects and built by Maven framework will have names of its subprojects enclosed between `<module></module>` XML ele-ment. **Gradle** build file is a settings file used by Gradle framework to assemble the project description, its sub-projects and dependencies for a build. Its name is `settings.gradle` and it uses `include` commands to build related subprojects. Unsurprisingly, a `SystemProjectBuildFile` element references all ‘local’ subprojects constructing an architecture project where each subproject is represented by `MicroserviceProjectArtifactsModel` element. 
`MicroserviceProjectArtifactsModel` | `ModuleName` | this element is simply an aggregation of all artefacts generated by `Spring Framework` and related to one ‘local’ microservice project composing an architecture project. `MicroserviceProjectArtifactsModel` has elements corresponding to a particular type of microservice project artefact file. 

